name: sybile-test-ci

on:
  push:
    branches: [ main ]

 
env:
  EXPORT_NAME: project-sybile


jobs:
  export-web:
    name: Web Export
    runs-on: ubuntu-latest
    container:
      image: adamrehn/ue4-engine
    steps:
      - name: Checkout
        uses: actions/checkout@v1

      - name: Setup
        run: |
          ls ${{ github.workspace }}

      - name: Build Unreal Project
        run: |
          cd project
          mkdir ./$EXPORT_NAME
          cd $EXPORT_NAME
          mkdir -v -p build/web
          cp  ${{ github.workspace }} build/web/

      - name: Upload Artifacts
        uses: actions/upload-artifact@v2
        with:
          name: web
          path: project/${{ env.EXPORT_NAME }}/build/web

      - name: Publish to itch.io
        uses: josephbmanley/butler-publish-itchio-action@v1.0.2
        env:
          BUTLER_CREDENTIALS: ${{ secrets.BUTLER_API_KEY }}
          CHANNEL: web
          ITCH_GAME: morpion
          ITCH_USER: junkeecheese
          PACKAGE: project/${{ env.EXPORT_NAME }}/build/web

      - name: Notify Discord Channel
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        uses: Ilshidur/action-discord@0.3.0
        with:
          args: 'A new update of my project is available at https://kim.itch.io/rat. You should try it!'